{% extends 'master.html' %}

{% block content %}
<body>
    <header>
        <div class="container">
            <nav>
                <a class="logo">Romdoul Shop</a>
                <ul class="nav-links">
                    <li><a href="/">Home</a></li>
                    <li><a href="/product">Products</a></li>
                    <li><a href="/about_us">About Us</a></li>
                    <li><a href="/contact_us">Contact Us</a></li>
                </ul>
                <div class="mobile-menu">
                    <i class="fas fa-bars"></i>
                </div>
            </nav>
        </div>
    </header>

    <main class="container">
    <section class="products">
        <h3 class="section-title">Featured Products</h3>
        <div class="product-grid">
            {% for item in products %}
            <div class="product-card">
                <div class="discount" data-category="{{ item.get('category', '') }}">
                    {{ item.get('category', '') }}
                </div>
                <img src="{{ item.get('image', '') }}"
                     alt="{{ item.get('title', 'Product image') }}"
                     style="height: 200px; object-fit: contain;"
                     onerror="this.style.display='none'">
                <a href="/product_detail/{{ item.id }}" class="product-title">
                  {{ item.get('title', 'Untitled Product') }}
                </a>

                <p>${{ "%.2f"|format(item.get('price', 0)|float) }}</p>
                <input
                    type="button"
                    value="Add to Cart"
                    class="btn-add-to-cart"
                    id="add-to-cart-{{ item.id }}"
                    name="add-to-cart"
                    data-id="{{ item.id }}"
                    data-title="{{ item.get('title', '') }}"
                    data-price="{{ item.get('price', 0) }}"
                    data-image="{{ item.get('image', '') }}"
                >
            </div>
            {% endfor %}
        </div>
    </section>
</main>
</body>

<!-- Remove the duplicate JavaScript product list -->
{% endblock %}

{% block custom_script %}
<script>
    // Initialize cart from localStorage
    let carts = JSON.parse(localStorage.getItem('carts')) || [];

    document.querySelectorAll('.btn-add-to-cart').forEach(button => {
        button.addEventListener('click', function() {
            const product = {
                id: this.getAttribute('data-id'),
                title: this.getAttribute('data-title'),
                price: this.getAttribute('data-price'),
                image: this.getAttribute('data-image'),
                quantity: 1
            };

            // Check if product exists in cart
            const existingIndex = carts.findIndex(item => item.id === product.id);

            if (existingIndex >= 0) {
                carts[existingIndex].quantity += 1;
            } else {
                carts.push(product);
            }

            // Update localStorage
            localStorage.setItem('carts', JSON.stringify(carts));
            countCartItem()
        });
    });
</script>
{% endblock %}